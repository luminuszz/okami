FROM node:18-alpine3.16

WORKDIR /app

COPY package.json .

RUN yarn install

ENV PATH="/app/node_modules/.bin/nest:$PATH"

RUN yarn global add pm2

COPY . ./

RUN npx prisma generate

RUN yarn build

CMD ["pm2-runtime", "./dist/src/main.js"]