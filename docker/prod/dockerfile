FROM node:18-alpine3.16
ENV NEW_RELIC_NO_CONFIG_FILE=true
ENV NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true \
NEW_RELIC_LOG=stdout

WORKDIR /app


COPY  package.json ./
COPY pnpm-lock.yaml ./

RUN corepack enable

RUN corepack prepare pnpm@latest --activate

RUN pnpm install

RUN pnpm install pm2

COPY . .

RUN pnpm exec prisma generate

RUN  pnpm run build

CMD ["pnpm", "exec", "pm2-runtime", "./ecosystem.config.js"]
