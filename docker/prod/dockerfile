FROM node:18-alpine3.16

WORKDIR /app

COPY  package.json ./
COPY  yarn.lock ./

ENV NEW_RELIC_NO_CONFIG_FILE=true
ENV NEW_RELIC_DISTRIBUTED_TRACING_ENABLED=true \
NEW_RELIC_LOG=stdout

RUN corepack enable

RUN yarn set version berry

RUN yarn install

COPY . .

RUN yarn build

CMD ["node", "./dist/src/main.js"]
